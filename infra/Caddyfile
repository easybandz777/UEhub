# Caddy configuration for UE Hub production
# Replace with your actual domain when DNS propagates
{$DOMAIN:localhost} {
    # Backend API routes
    handle /api/* {
        reverse_proxy backend:8080
    }
    
    # Health checks
    handle /health* {
        reverse_proxy backend:8080
    }
    
    # Everything else goes to frontend
    handle /* {
        reverse_proxy frontend:3000
    }
    
    # Enable compression
    encode gzip
    
    # Security headers
    header {
        # Enable HSTS (only for HTTPS)
        Strict-Transport-Security max-age=31536000;
        # Prevent MIME sniffing
        X-Content-Type-Options nosniff
        # Prevent clickjacking
        X-Frame-Options DENY
        # XSS Protection
        X-XSS-Protection "1; mode=block"
    }
}

# Fallback for IP access during setup
:80 {
    # Backend API routes
    handle /api/* {
        reverse_proxy backend:8080
    }
    
    # Health checks
    handle /health* {
        reverse_proxy backend:8080
    }
    
    # Everything else goes to frontend
    handle /* {
        reverse_proxy frontend:3000
    }
    
    # Enable compression
    encode gzip
}
